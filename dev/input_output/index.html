<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Input-Output Relations · WaveguideQED.jl</title><meta name="title" content="Input-Output Relations · WaveguideQED.jl"/><meta property="og:title" content="Input-Output Relations · WaveguideQED.jl"/><meta property="twitter:title" content="Input-Output Relations · WaveguideQED.jl"/><meta name="description" content="Documentation for WaveguideQED.jl."/><meta property="og:description" content="Documentation for WaveguideQED.jl."/><meta property="twitter:description" content="Documentation for WaveguideQED.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">WaveguideQED.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">WaveguideQED.jl</a></li><li><a class="tocitem" href="../theoreticalbackground/">Theoretical Background</a></li><li><a class="tocitem" href="../tutorial/">Tutorials</a></li><li><a class="tocitem" href="../multiplewaveguides_v2/">Multiple Waveguides</a></li><li><a class="tocitem" href="../beamsplitter/">Beamsplitters</a></li><li class="is-active"><a class="tocitem" href>Input-Output Relations</a><ul class="internal"><li><a class="tocitem" href="#Theory"><span>Theory</span></a></li><li><a class="tocitem" href="#Waveguide-with-Partially-Transmitting-Element"><span>Waveguide with Partially Transmitting Element</span></a></li></ul></li><li><a class="tocitem" href="../time_delay/">Non-Markovian dynamics</a></li><li><a class="tocitem" href="../gpu_support/">GPU Support</a></li><li><a class="tocitem" href="../API/">API</a></li><li><a class="tocitem" href="../references/">References and suggested readings</a></li><li><span class="tocitem">Experimental or Outdated functionalities</span><ul><li><a class="tocitem" href="../detection/">Detection and Projections</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Input-Output Relations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Input-Output Relations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/qojulia/WaveguideQED.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/qojulia/WaveguideQED.jl/blob/main/docs/src/input_output.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="input"><a class="docs-heading-anchor" href="#input">Input-Output Relations</a><a id="input-1"></a><a class="docs-heading-anchor-permalink" href="#input" title="Permalink"></a></h1><h2 id="Theory"><a class="docs-heading-anchor" href="#Theory">Theory</a><a id="Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Theory" title="Permalink"></a></h2><p>In waveguide QED systems, the waveguide modes themselves can often also interact. This interaction can happen due to e.g. a partially transmitting and reflecting element that scatters one waveguide mode into another. In the input-output formalism, this is described by a coupling matrix <span>$\mathbf{C}$</span>. A perfectly balanced beamsplitter would thus have the coupling matrix <span>$\mathbf{C} = 1/\sqrt{2}\begin{pmatrix} 1 &amp; - i \\ -i &amp; 1 \end{pmatrix}$</span> which relates the input waveguide modes with the output modes (output here referring to the mode after the interaction) by the following relation:</p><p class="math-container">\[\begin{equation*}
    \mathbf{W}_{\mathrm{out}} = \mathbf{C} \mathbf{W}_{\mathrm{in}}
\end{equation*}\]</p><p>where</p><p class="math-container">\[\begin{equation*}
    \mathbf{W}_{in} = \begin{pmatrix}
        w_{in,1}(t) \\ w_{in,2}(t) \\ \vdots \\ w_{in,N}(t)
    \end{pmatrix}, \ \ \ \ \ \ \ \ \mathbf{W}_{out} = \begin{pmatrix}
    w_{out,1}(t) \\ w_{out,2}(t) \\ \vdots \\ w_{out,N}(t)
    \end{pmatrix}    
\end{equation*}\]</p><p>Are vectors containing each waveguide mode. More generally, when a local quantum system with the Hamiltonian <span>$H_s$</span> and creation and annihilation operators <span>$a$</span> and <span>$a^\dagger$</span> is coupled to the waveguide it is shown in [<a href="../references/#Xu2016">4</a>], that fundamental input-output relations can be derived from the Hamiltonian:</p><p class="math-container">\[\begin{equation*}
    H= H_{\mathrm{s}}+ \sum_{i=1}^N \int d \nu \hbar \nu w_{i}^{\dagger}(\nu) w_{i}(\nu)+\sum_{i=1}^N \hbar \sqrt{\gamma_i} \int \frac{d \nu}{\sqrt{2 \pi}}\left(w_{i}^{\dagger}(\nu) a+a^{\dagger} w_{i}(\nu)\right) +\sum_{i \neq j} \hbar V_{i j} \int \frac{d \nu}{\sqrt{2 \pi}} \int \frac{d  \nu^{\prime}}{\sqrt{2 \pi}} w_{i}^{\dagger}(\nu) w_{j}(\nu^\prime)
\end{equation*}\]</p><p>where <span>$w_{i}(\nu)$</span> is the annihilation operator for waveguide mode <span>$i$</span> with frequency <span>$\nu$</span>, <span>$\gamma_i$</span> is the coupling between the local system with Hamiltonian <span>$H_s$</span> and waveguide mode <span>$i$</span>, and <span>$V_{i,j} =V_{j,i}$</span> is the unitless coupling between waveguide modes. <span>$N$</span> is here the total number of waveguide modes. The resulting input-output relations depend on the evolution of the local system and thus become:</p><p class="math-container">\[\begin{equation*}
    \begin{gathered}
    \frac{d}{d t} a=-i\left[a, H_{\mathrm{c}}\right]-\Sigma a+\mathbf{k}^T \mathbf{W}_{\mathrm{in}} \\
    \mathbf{W}_{\text {out }}(t)=\mathbf{C} \mathbf{W}_{\mathrm{in}}(t)+a(t)\mathbf{d}
    \end{gathered}
\end{equation*}\]</p><p>Here <span>$\Sigma$</span> describes a self-energy correction due to the interaction with the waveguides, and <span>$\mathbf{k}=\mathbf{d}$</span> is the effective coupling between the waveguides and quantum system. All quantities depend on the waveguide coupling <span>$\mathbf{V}$</span> and waveguide-system coupling <span>$\mathbf{\Gamma}$</span> </p><p class="math-container">\[\begin{equation*}
    \textbf{V} = \begin{pmatrix}
        0 &amp; V_{1,2} &amp; \cdots &amp; V_{1,N} \\
        V_{2,1} &amp; 0 &amp; \cdots &amp; V_{2,N} \\
        \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
        V_{N,1} &amp; V_{N,2} &amp; \cdots &amp; 0 \\
    \end{pmatrix},   \ \ \ \ \ \ \ \ \ \ \mathbf{\Gamma} =  \begin{pmatrix}
        \gamma_1 \\
        \gamma_2 \\
        \vdots \\
        \gamma_N
    \end{pmatrix}
\end{equation*}\]</p><p>as:</p><p class="math-container">\[\begin{equation*}
    \mathbf{C} \equiv\left(\mathbf{I}-\frac{i}{2} \mathbf{V}\right)\left(\mathbf{I}+\frac{i}{2} \mathbf{V}\right)^{-1}, \quad \mathbf{d} = \mathbf{k} \equiv-i\left(\mathbf{I}+\frac{i}{2} \mathbf{V}\right)^{-1} \mathbf{\Gamma}, \quad \Sigma \equiv \frac{1}{2} \mathbf{\Gamma}^T\left(\mathbf{I}+\frac{i}{2} \mathbf{V}\right)^{-1} \mathbf{\Gamma} 
\end{equation*}\]</p><p>from this, it is evident that the coupling with the system <span>$\mathbf{k}=\mathbf{d}$</span> is not independent of the waveguide coupling <span>$\mathbf{V}$</span>. As we shall see, this can be interpreted as the waveguide coupling <span>$\mathbf{V}$</span> altering the local density of optical states and thus changing the coupling between the waveguides and the local system. In the time-bin formalism, we cannot simply simulate the Hamiltonian, since coupling between waveguide modes is not allowed in a collision picture. Instead, we can introduce an effective coupling and simulate the Hamiltonian:</p><p class="math-container">\[\begin{equation*}
    H= \tilde{H}_{\mathrm{s}}+ \sum_{i=1}^N \int d \nu \hbar \nu w_{i}^{\dagger}(\nu) w_{i}(\nu)+\sum_{i=1}^N \hbar \int \frac{d \nu}{\sqrt{2 \pi}}\left(\tilde{\Gamma}_i^* w_{i}^{\dagger}(\nu) a+ \tilde{\Gamma}_i a^{\dagger} w_{i}(\nu)\right)
\end{equation*}\]</p><p>where <span>$\tilde{\Gamma}_i$</span> is the i&#39;th element of <span>$\mathbf{\tilde{\Gamma}} = (\mathbf{I} + \frac{i}{2}\mathbf{V})^{-1} \mathbf{\Gamma}$</span> and <span>$\tilde{H}_{c} = H_c - i\mathrm{Im}\{ \Sigma\} a^\dagger a$</span> is the normalized system Hamiltonian due to the self-energy correction (note only the imaginary part since the real part correction will be introduced from the renormalized coupling). The resulting input-out relations will from this Hamiltonian be:</p><p class="math-container">\[\begin{align*}
    &amp; \frac{d}{d t} a= -i\left[a, \tilde{H_{\mathrm{c}}} \right] -\mathrm{Re}(\Sigma) a + \tilde{\mathbf{k}}^T \mathbf{W}_{\mathrm{in}} \\
    &amp; \widetilde{\mathbf{W}}_{\text {out }}(t)= \mathbf{\tilde{C}} \mathbf{W}_{\mathrm{in}}(t)+a(t)\tilde{\mathbf{d}}
\end{align*}\]</p><p>where <span>$\tilde{\mathbf{d}} = -i \left(\left(\mathbf{I}+\frac{i}{2} \mathbf{V}\right)^{-1} \right)^* \mathbf{\Gamma}$</span>, <span>$\tilde{\mathbf{k}} = -i \left(\left(\mathbf{I}+\frac{i}{2} \mathbf{V}\right)^{-1} \right) \mathbf{\Gamma}$</span>, and <span>$\tilde{\mathbf{C}} = \mathbf{I}$</span>. Noticeably, the renormalized coupling <span>$\tilde{\mathbf{C}}$</span> does not correspond to the original input-output relations, by multiplying <span>$\widetilde{\mathbf{W}}_{\text {out }}(t)$</span> with <span>$\mathbf{C}$</span> we can restore the correct relations:</p><p class="math-container">\[\begin{align*}
&amp; \frac{d}{d t} a= -i\left[a, \tilde{H_{\mathrm{c}}} \right] -\mathrm{Re}(\Sigma) a + \tilde{\mathbf{k}}^T \mathbf{W}_{\mathrm{in}} \\
&amp; \mathbf{C}\widetilde{\mathbf{W}}_{\text {out }}(t)= \mathbf{C} \mathbf{W}_{\mathrm{in}}(t)+a(t)\tilde{\mathbf{k}}
\end{align*}\]</p><p>where we used that <span>$\mathbf{C} \mathbf{\tilde{d}} = \mathbf{\tilde{k}$</span>. In the time-bin picture, we can thus use the Hamiltonian:</p><p class="math-container">\[\begin{equation*}
    H_k= H_{\mathrm{s}}+ \sum_{i=1}^N \hbar \tilde{\Gamma}_i^* w_{k,i}^{\dagger} a+ \tilde{\Gamma}_i a^{\dagger} w_{k,i}
\end{equation*}\]</p><p>to obtain <span>$\ket{\tilde{\psi}}_{\mathrm{out}} = \sum_i \int \widetilde{W}_{out,i}^\dagger \ket{\emptyset} \otimes \ket{\psi}_{s1}$</span> where <span>$\ket{\psi}_{s1}$</span> is the system state after the simulation. To get the correct output state we then perform the transformation according to <span>$\mathbf{C}$</span> such that: </p><p class="math-container">\[\begin{equation*}
    \ket{\psi}_{\mathrm{out}} = C^\dagger \ket{\tilde{\psi}}_{\mathrm{out}} = \sum_{i,j} \int C_{i,j}^\dagger \widetilde{W}_{out,i}^\dagger \ket{\emptyset} \otimes \ket{\psi}_{s1} = \sum_i \int W_{out,i}^\dagger \ket{\emptyset} \otimes \ket{\psi}_{s1}
\end{equation*}\]</p><p>We here only show the case where the output state is a superposition of single-photon states, but this can be generalized to multiple-photon states (although this has not been implemented yet). In the following, we show how we can use the above to predict Fano-resonances in waveguide systems.</p><h2 id="Waveguide-with-Partially-Transmitting-Element"><a class="docs-heading-anchor" href="#Waveguide-with-Partially-Transmitting-Element">Waveguide with Partially Transmitting Element</a><a id="Waveguide-with-Partially-Transmitting-Element-1"></a><a class="docs-heading-anchor-permalink" href="#Waveguide-with-Partially-Transmitting-Element" title="Permalink"></a></h2><p>In the following, we consider a waveguide with two propagating modes (left and right) and a scattering element <span>$V$</span> that couples the two modes with each other. The waveguide is also coupled to a quantum emitter through a total decay rate of <span>$\gamma$</span> meaning a coupling of <span>$\gamma/2$</span> to each waveguide mode. A sketch of the system can be seen below: <img src="../illustrations/fanowaveguide.svg" alt="alt text"/> This is almost the system considered in <a href="../multiplewaveguides_v2/#multiple">Multiple Waveguides</a>, except that we have now introduced the scattering element V.</p><p>As mentioned above, we can capture the dynamics of the system by renormalizing the coupling depending on the waveguide interaction <span>$V$</span>. This can be done automatically in <strong>WaveguideQED</strong> by giving a vector of the waveguide-emitter coupling, which in this case is: <span>$\mathbf{\Gamma} = \begin{pmatrix} \gamma/2 \\ \gamma/2 \end{pmatrix}$</span> and the desired waveguide coupling <span>$\mathbf{C}$</span>. For example, if we want a fully reflecting element we would choose <span>$\mathbf{C} = \begin{pmatrix} 0 &amp; 1 \\ 1 &amp; 0  \end{pmatrix}$</span>. The function <a href="../API/#WaveguideQED.effective_hamiltonian-Union{Tuple{Nw}, Tuple{Np}, Tuple{WaveguideBasis{Np, Nw}, Any, Any, Any}} where {Np, Nw}"><code>effective_hamiltonian</code></a> returns the renormalized Hamiltonian:</p><pre><code class="language-julia hljs">times = 0:0.05:50
dt = times[2] - times[1]

bw = WaveguideBasis(1,2,times)
be = FockBasis(1)


C = [0 -1.0im; -1.0im 0]
γ=1
G = [sqrt(γ/dt),sqrt(γ/dt)]

H = effective_hamiltonian(bw,be,C,G)</code></pre><p>With this, we can study the scattering of single photon pulse. In the following, we initialize the state and simulate the scattering.</p><pre><code class="language-julia hljs">ξfun(t1,σ,t0) = sqrt(2/σ)* (log(2)/pi)^(1/4)*exp(-2*log(2)*(t1-t0)^2/σ^2)

ψ_in = onephoton(bw,1,ξfun,1,5) ⊗ fockstate(be,0)
ψ_out_tilde = waveguide_evolution(times,ψ_in,H)</code></pre><p>We now have obtained <span>$\ket{\tilde{\psi}}_{\mathrm{out}}$</span> and we then apply the transformation of <span>$\mathbf{C}$</span> to get <span>$\ket{\psi}_{\mathrm{out}}$</span>. This can be done with the <a href="../API/#WaveguideQED.WaveguideTransform"><code>WaveguideTransform</code></a> operator:</p><pre><code class="language-julia hljs">C_transform = WaveguideTransform(bw,C) ⊗ identityoperator(be)
ψ_out = C_transform*ψ_out_tilde</code></pre><p>Plotting the output state, we see that compared with the example in <a href="../multiplewaveguides_v2/#multiple">Multiple Waveguides</a> the transmitted (right) and reflected mode (left) are interchanged due to the fully reflecting medium <span>$V$</span>:</p><pre><code class="language-julia hljs">fig,ax = subplots(1,1,figsize=(9,4.5))
ax.plot(times,abs.(OnePhotonView(ψ_out,1)).^2,&quot;r-&quot;,label=&quot;Right&quot;)
ax.plot(times,abs.(OnePhotonView(ψ_out,2)).^2,&quot;b-&quot;,label=&quot;Left&quot;)
ax.set_xlim(0,20)
ax.legend()
plt.tight_layout()</code></pre><p><img src="../inputoutput.svg" alt="alt text"/></p><p>The shapes are qualitatively the same as in <a href="../multiplewaveguides_v2/#multiple">Multiple Waveguides</a> but if we study the actual numbers, we will see that the effective emitter-waveguide coupling has been renormalized due to the scattering element. This is especially clear if we consider an initially excited emitter and its emission spectrum. In the following, we vary the waveguide coupling through <span>$V$</span> and see how the emission spectrum (Fourier transformation of the time-wavefunction <span>$\xi(t)$</span>) changes. </p><pre><code class="language-julia hljs">fig,ax = subplots(1,1,figsize=(9,4.5))
color_plots = [&quot;red&quot;,&quot;blue&quot;,&quot;green&quot;,&quot;black&quot;,&quot;purple&quot;,&quot;cyan&quot;,&quot;darkorange&quot;,&quot;darkblue&quot;,&quot;darkgreen&quot;]

Vs = 0:0.3:2
G = [sqrt(γ/dt),sqrt(γ/dt)]
for (i,V) in enumerate(Vs)

    C_sweep,_ = WaveguideQED.io_relations_from_V([0 V;V 0],G)
    H_sweep = effective_hamiltonian(bw,be,C_sweep,G)

    psi_in = zerophoton(bw) ⊗ fockstate(be,1)
    psi_out = waveguide_evolution(times,psi_in,H_sweep)
    freq,spec = fftket(psi_out,1)
    ax.plot(freq,2*pi*abs.(spec*(freq[2]-freq[1])).^2,ls=&quot;-&quot;,color=color_plots[i],label=L&quot;$V=$&quot;*&quot;$(round(Vs[i],digits=2))&quot;)
end
ax.legend(loc=&quot;upper left&quot;,fontsize=18)
ax.set_xlim(-4,4)
ax.set_xlabel(L&quot;$\omega - \omega_e \ [\gamma]$&quot;)
ax.set_ylabel(L&quot;$S(w)$ [$\gamma$]&quot;)</code></pre><p><img src="../emitter_lifetime.svg" alt="alt text"/></p><p>We can see that the frequency of the emission spectrum shift as we increase <span>$V$</span> but also the FWHM of the Lorentzian narrows due to an increase in the emitter lifetime (decrease in the effective emitter-waveguide coupling).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../beamsplitter/">« Beamsplitters</a><a class="docs-footer-nextpage" href="../time_delay/">Non-Markovian dynamics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Tuesday 22 April 2025 07:41">Tuesday 22 April 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
